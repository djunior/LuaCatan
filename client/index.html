<!DOCTYPE html>
<html>
    <body>

    <canvas id="canvas" width="800" height="600" style="border:1px solid #d3d3d3;">
        Your browser does not support the HTML5 canvas tag.
    </canvas>

    <script src="js/socketClient.js"></script>
    <script src="js/clientAPI.js"></script>
    <script src="js/player.js"></script>
    <script src="js/shapes.js"></script>
    <script src="js/elements.js"></script>
    <script src="js/vertex.js"></script>
    <script src="js/tile.js"></script>
    <script src="js/board.js"></script>

    <script>
        var c = document.getElementById("canvas");
        var ctx = c.getContext("2d");

        function getMousePos(canvas, evt) {
            var rect = canvas.getBoundingClientRect();
            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        }

        function draw(board, e) {
            var pos = getMousePos(canvas, e);
            if (board.onMouseMove(pos)) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                board.draw(ctx);
            }
        }

        function onClick(board, e) {
            var pos = getMousePos(canvas, e);
            if (board.onMouseClick(pos)) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                board.draw(ctx);
            }
        }

        var clientAPI = new ClientAPI(function() {
            clientAPI.newGame(function(gameInfo){
                console.log("GameInfo:" + JSON.stringify(gameInfo));
                var player = new Player(gameInfo.playerId);

                clientAPI.getBoard(function (tileList) {
                    var board = new Board(clientAPI,player,tileList);
                    board.draw(ctx);

                    window.addEventListener('mousemove', (e) => { draw(board,e); }, false);
                    window.addEventListener('click', (e) => { onClick(board,e); }, false);

                    clientAPI.registerHandler("addElement",(request) => {
                        console.log("Received request " + JSON.stringify(request));
                        board.addElementToVertex(request.vertexId,new Player(request.playerId));
                        board.draw(ctx);
                    });
                });
            });
        }, function () {});

    </script>

    </body>
</html>
